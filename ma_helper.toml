# ma_helper configuration for the Music Advisor monorepo.
# These defaults mirror the existing helper behavior; customize per repo as needed.

[paths]
registry = "project_map.json"
cache_dir = ".ma_cache"
# state_dir = "~/.ma_helper"  # override helper state/log location if desired

[scripts]
lint = "./infra/scripts/with_repo_env.sh -m ruff check hosts/advisor_host engines/recommendation_engine/recommendation_engine"
typecheck = "./infra/scripts/with_repo_env.sh -m mypy --config-file hosts/advisor_host/pyproject.toml hosts/advisor_host"
format = "./infra/scripts/with_repo_env.sh -m ruff format hosts/advisor_host engines/recommendation_engine/recommendation_engine"

[plugins.smokes]
pipeline = "./infra/scripts/quick_check.sh"
full = "./infra/scripts/e2e_app_smoke.sh"

[plugins.playbooks]
pipeline-dev = ["python -m ma_helper doctor", "python -m ma_helper smoke pipeline"]
host-dev = ["python -m ma_helper doctor", "python -m ma_helper smoke full"]
sidecar-dev = ["python -m ma_helper doctor", "python -m ma_helper watch audio_engine"]

[plugins.profiles.dev]
sparse = ["hosts", "shared", "tools"]
playbook = "host-dev"

[plugins.profiles.pipeline]
playbook = "pipeline-dev"

[plugins.profiles.minimal]
sparse = ["shared", "tools"]

[tasks.lint]
command = "python3 -m ma_helper lint && mkdir -p build && touch build/lint.ok"
inputs = ["hosts/advisor_host", "engines/recommendation_engine/recommendation_engine"]
outputs = ["build/lint.ok"]

[tasks.typecheck]
command = "python3 -m ma_helper typecheck && mkdir -p build && touch build/typecheck.ok"
deps = ["lint"]
inputs = ["hosts/advisor_host"]
outputs = ["build/typecheck.ok"]

[tasks.test-all]
command = "python3 -m ma_helper test-all && mkdir -p build && touch build/test-all.ok"
deps = ["lint", "typecheck"]
inputs = ["engines", "hosts", "shared", "tests"]
outputs = ["build/test-all.ok"]

[tasks.verify]
command = "python3 -m ma_helper verify && mkdir -p build && touch build/verify.ok"
deps = ["lint", "typecheck"]
inputs = ["engines", "hosts", "shared", "tests"]
outputs = ["build/verify.ok"]
